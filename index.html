<html>
<title>Sean Yu (sy334) Project1-Sample</title>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v2.min.js"></script>
<link href='https://fonts.googleapis.com/css?family=Catamaran' rel='stylesheet' type='text/css'/>

<!--<link rel="stylesheet" type="text/css" href="styles/style.css">-->

<style>  

svg { 
    border: solid #fff 1px; fill: #ccc; stroke: white 1px; }
  
body{
    font-family: "Catamaran"; 
    }  

/** MAIN DIV */
#main {
    width: 50%;
    margin-left: auto;
    margin-right: auto;
    margin-top: 30px;
}

#main h2 {
    font-weight: bolder;
    font-size: 4em;
    letter-spacing: 1px;

}

/** FEMALE DIV */
#femaletop {
    width: 100%;
    text-align: center;
    font-size: 2em;
    margin-top: 60px;
    margin-bottom: 0px;
    letter-spacing: 1px;
}

#female {
    width: 400px;
    height: 600px;
    margin-right: 20px;
    margin-top: 50px;
    float: right;
}

/** BLACK DIV */
#blacktop {
    width: 100%;
    text-align: center;
    font-size: 2em;
    margin-top: 60px;
    letter-spacing: 1px;
}

#black {
    width: 400px;
    height: 600px;
    margin-right: 20px;
    margin-top: 50px;
    float: right;
}

/** BLACK FEMALE DIV */
#blackfemaletop {
    width: 100%;
    text-align: center;
    font-size: 2em;
    margin-top: 60px;
    letter-spacing: 1px;
}

#blackfemale {
    width: 400px;
    height: 600px;
    margin-right: 20px;
    margin-top: 50px;
    float: right;
}    
    
</style>

<body>   

<!-- div for main body -->
<div id="main">
    
<h2>Who's taking the AP Computer Science Exam?</h2>
    
<p>"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."
</p>

</div>    
    
<!-- SVGs for USA maps and average statistics -->

<div id="femaletop">Female Test Takers</div>    
    
<svg id="p1" height = "600" width="800"></svg>
    
<div id="female">
    <p>Across the United States, female student participation in the 2012 AP Computer Science Exam varied by the hundreds. <b>Tennessee</b> had one of the highest participation rates at <b>31.25%</b>. It's next-door neighbor, <b>Arkansas</b>, was conversely one of the states with the lowest participation rate at <b>0%</b>.
    </p>
    
    <svg id="container1" height = "600" width="350">
    </svg> 
</div>
   
<div id="blacktop">African-American Test Takers</div>      
    
<svg id="p2" height = "600" width="800"></svg>
    
<div id="black">
    <p>"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."
    </p>
    
    <svg id="container2" height = "600" width="350">
    </svg>
</div>   
    
<div id="blacktop">African-American Female Test Takers</div>    
    
<svg id="p3" height = "600" width="800">
    
<div id="blackfemale">
    <p>"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."
    </p>
    
     <svg id="container3" height = "600" width="350">
    </svg>
        
    </div>
</svg>
    
<script>
    
// Average percentage for female student map    
d3.select("#container1").append("text")
        .attr("x", 0)
        .attr("y", 146)
        .attr("font-size", 150)
        .text("27%")
        .style("fill", "black");   
d3.select("#container1").append("text")
        .attr("x", 30)
        .attr("y", 190)
        .attr("font-size", 30)
        .text("National Average")
        .style("fill", "black");
    
// Average percentage for black student map
d3.select("#container2").append("text")
        .attr("x", 0)
        .attr("y", 146)
        .attr("font-size", 150)
        .text("3.4%")
        .style("fill", "black");   
d3.select("#container2").append("text")
        .attr("x", 30)
        .attr("y", 190)
        .attr("font-size", 30)
        .text("National Average")
        .style("fill", "black");
    
// Average percentage for black female student map
d3.select("#container3").append("text")
        .attr("x", 0)
        .attr("y", 146)
        .attr("font-size", 110)
        .text("0.76%")
        .style("fill", "black");   
d3.select("#container3").append("text")
        .attr("x", 30)
        .attr("y", 190)
        .attr("font-size", 30)
        .text("National Average")
        .style("fill", "black");
    
var p1 = d3.select("#p1");
var p2 = d3.select("#p2");
var p3 = d3.select("#p3");
var svg = d3.select("svg");

var projection = d3.geoAlbersUsa().scale(75);
var pathGenerator = d3.geoPath().projection(projection);

var colors = [ '#f1eef6', '#d7b5d8','#df65b0','#dd1c77','#980043'];

var scale = d3.scaleLinear()
.domain([0,5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100]).range(colors);

var states;
var apcsdata;

// function to handle any row-by-row processing on CSV
var parseRow = function(row) {
	row.FIPS = Number(row.FIPS);
	return row;
}

var apcs;
d3.csv("apcs.csv",function(data){apcs=data});


d3.queue()
.defer(d3.json, "us.json")
.defer(d3.csv, "apcs.csv", parseRow)
.await(function (error, rawMap, rawAtlas) {

	states = topojson.feature(rawMap, rawMap.objects.states);

	apcsdata = d3.map(rawAtlas, function (d) {
		return d.FIPS;
	});

	showMap(scale, "%female", p1);
	showMap(scale, "% black", p2);
	showMap(scale, "% Black Females", p3);
});

function showMap(scale, variable, part) {
	// Create or modify paths for each country
	var p1 = part;

	projection.fitExtent([[0,0], [p1.attr("width"), p1.attr("height")]], states);
	pathGenerator = d3.geoPath().projection(projection);

	var paths = p1.selectAll("path.country").data(states.features);
	paths.enter().append("path").attr("class", "country")
	.merge(paths)
    .style("stroke", "white")
	.style("fill", function (state) {
		var stateData = apcsdata.get(state.id);
		if (stateData) {
			return scale(stateData[variable]);
		}

	})
	.attr("d", function (state) {
		return pathGenerator(state);
	});


}
   
// Beginning of linear gradient scales (to use as a legend)

var defs = svg.append("defs");

var linearGradient = defs.append("linearGradient")
    .attr("id", "linear-gradient");
    
linearGradient.selectAll("stop") 
    .data([                             
        {offset: "0%", color: "#f1eef6"}, 
        {offset: "20%", color: "#d7b5d8"},  
        {offset: "40%", color: "#df65b0"}, 
        {offset: "60%", color: "#dd1c77"}, 
        {offset: "80%", color: "#5D000F"}  
      ])                  
    .enter().append("stop")
    .attr("offset", function(d) { return d.offset; })   
    .attr("stop-color", function(d) { return d.color; });

    
//Horizontal gradient
linearGradient
    .attr("x1", "0%")
    .attr("y1", "0%")
    .attr("x2", "100%")
    .attr("y2", "0%");
    
// Gradient for female students
d3.select("#p1").append("rect")
    .attr("x", 385)
    .attr("y", 560)
	.attr("width", 290)
	.attr("height", 20)
	.style("fill", "url(#linear-gradient)");
    
//Add corresponding text
d3.select("#p1").append("text")
        .attr("x", 382)
        .attr("y", 595)
        .attr("font-size", 10)
        .attr("font-family", "Catamaran")
        .text("0%")
        .style("fill", "gray");
    
d3.select("#p1").append("text")
        .attr("x", 668)
        .attr("y", 595)
        .attr("font-size", 10)
        .attr("font-family", "Catamaran")
        .text("25%+")
        .style("fill", "gray");
    
d3.select("#p1").append("text")
        .attr("x", 438)
        .attr("y", 550)
        .attr("font-size", 10)
        .attr("font-family", "Catamaran")
        .text("Percentage of Test-Takers by State")
        .style("fill", "gray");

// Gradient for black test takers
d3.select("#p2").append("rect")
    .attr("x", 385)
    .attr("y", 560)
	.attr("width", 290)
	.attr("height", 20)
	.style("fill", "url(#linear-gradient)");
    
//Add corresponding text
d3.select("#p2").append("text")
        .attr("x", 382)
        .attr("y", 595)
        .attr("font-size", 10)
        .attr("font-family", "Catamaran")
        .text("0%")
        .style("fill", "gray");
    
d3.select("#p2").append("text")
        .attr("x", 668)
        .attr("y", 595)
        .attr("font-size", 10)
        .attr("font-family", "Catamaran")
        .text("25%+")
        .style("fill", "gray");
    
d3.select("#p2").append("text")
        .attr("x", 438)
        .attr("y", 550)
        .attr("font-size", 10)
        .attr("font-family", "Catamaran")
        .text("Percentage of Test-Takers by State")
        .style("fill", "gray");
    
// Gradient for black female test takers
d3.select("#p3").append("rect")
    .attr("x", 385)
    .attr("y", 560)
	.attr("width", 290)
	.attr("height", 20)
	.style("fill", "url(#linear-gradient)");
    
//Add corresponding text
d3.select("#p3").append("text")
        .attr("x", 382)
        .attr("y", 595)
        .attr("font-size", 10)
        .attr("font-family", "Catamaran")
        .text("0%")
        .style("fill", "gray");
    
d3.select("#p3").append("text")
        .attr("x", 668)
        .attr("y", 595)
        .attr("font-size", 10)
        .attr("font-family", "Catamaran")
        .text("25%+")
        .style("fill", "gray");
    
d3.select("#p3").append("text")
        .attr("x", 438)
        .attr("y", 550)
        .attr("font-size", 10)
        .attr("font-family", "Catamaran")
        .text("Percentage of Test-Takers by State")
        .style("fill", "gray");
    
// End of linear gradient scales    
</script>
    
</body>
    
<!-- Linear gradient created with help of https://www.visualcinnamon.com/2016/05/smooth-color-legend-d3-svg-gradient.html -->    
</html>
